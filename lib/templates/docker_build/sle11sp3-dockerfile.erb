FROM scratch
MAINTAINER "Flavio Castelli <fcastelli@suse.com>"

ADD <%= prebuilt_image %> /

<% repositories.each do |url, name| %>
RUN zypper ar -f <%= url %> "<%= name %>"
<% end %>

<% if !credentials.empty? %>
RUN mkdir /etc/zypp/credentials.d
RUN echo "username=<%= credentials[:username] %>" > /etc/zypp/credentials.d/<%= credentials[:filename] %>
RUN echo "password=<%= credentials[:password] %>" > /etc/zypp/credentials.d/<%= credentials[:filename] %>
RUN chmod 600 /etc/zypp/credentials.d/NCCcredentials
<% end %>

RUN zypper --gpg-auto-import-keys refresh

