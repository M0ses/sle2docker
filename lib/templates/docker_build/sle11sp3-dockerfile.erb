FROM scratch
MAINTAINER "Flavio Castelli <fcastelli@suse.com>"

ADD <%= prebuilt_image %> /

RUN zypper ar -f http<%= "s" if enable_https %>://<%= host %>/repo/\$RCE/SLES11-SP3-Updates/sle-11-x86_64?credentials=NCCcredentials SLES11-SP3-Updates
RUN zypper ar -f http<%= "s" if enable_https %>://<%= host %>/repo/\$RCE/SLES11-SP3-Pool/sle-11-x86_64?credentials=NCCcredentials SLES11-SP3-Pool

<% if !credentials.empty? %>
RUN mkdir /etc/zypp/credentials.d
RUN echo "username=<%= credentials[:username] %>" > /etc/zypp/credentials.d/<%= credentials[:filename] %>
RUN echo "password=<%= credentials[:password] %>" > /etc/zypp/credentials.d/<%= credentials[:filename] %>
RUN chmod 600 /etc/zypp/credentials.d/NCCcredentials
<% end %>

RUN zypper --gpg-auto-import-keys refresh

